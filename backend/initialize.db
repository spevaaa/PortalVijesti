DROP DATABASE IF EXISTS news_portal;
CREATE DATABASE IF NOT EXISTS news_portal;
USE news_portal;

CREATE TABLE categories (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(50) NOT NULL
);

CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL,
  email VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  role ENUM('admin', 'user') DEFAULT 'user'
);

CREATE TABLE news (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    image_url VARCHAR(255),
    category_id INT,
    author_id INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,
    FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE

);

CREATE TABLE comments (
    id INT AUTO_INCREMENT PRIMARY KEY,
    news_id INT NOT NULL,
    user_id INT NOT NULL,
    text TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (news_id) REFERENCES news(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);





INSERT INTO categories (name) VALUES ('Politika'), ('Sport'), ('Tehnologija'), ('Zabava');


INSERT INTO users (username, email, password, role) VALUES 
('admin', 'admin@admin.hr', '$2b$10$LoFMtAtiUqaP6qptR4QYw.7lGou34hVUB47B1EWOyjHUvaUOPqHWa', 'admin'),
('mateo', 'mateo@gmail.com', '$2b$10$4VFh8f48ExTrSyvQXKPHSu01NuZNygKZbPn4gcpzwjpoCTbEe2rWq', 'user');

INSERT INTO news (title, content, image_url, category_id, author_id) VALUES 
(
  'Lansirana nova generacija procesora', 
  'Vodeći svjetski proizvođači danas su predstavili čipove koji troše 30% manje energije uz dvostruko veće performanse u AI zadacima. Očekuje se da će prvi laptopi biti dostupni već krajem mjeseca.', 
  'https://images.unsplash.com/photo-1518770660439-4636190af475?w=800', 
  3, 1
),
(
  'Veliki preokret u završnici utakmice', 
  'Domaća momčad uspjela je nadoknaditi zaostatak od dva gola u posljednjih pet minuta susreta. Navijači su u deliriju, a trener gostiju najavio je žalbu zbog spornog kaznenog udarca.', 
  'https://images.unsplash.com/photo-1486286701208-1d58e9338013?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8Zm9vdGJhbGx8ZW58MHx8MHx8fDA%3D', 
  2, 1
),
(
  'Novi zakon o radu od ponedjeljka', 
  'Sabor je usvojio izmjene zakona koje donose veću fleksibilnost kod rada od kuće, ali i strože kazne za poslodavce koji ne poštuju pravo na isključenje radnika nakon radnog vremena.', 
  'https://plus.unsplash.com/premium_photo-1661284828052-ea25d6ea94cd?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8d29ya3xlbnwwfHwwfHx8MA%3D%3D', 
  1, 1
),
(
  'Otvoren najveći filmski festival u regiji', 
  'Crveni tepih ugostio je brojne domaće i strane zvijezde. Festival otvara premijera nagrađivane drame koja istražuje složene obiteljske odnose u modernom društvu.', 
  'https://images.unsplash.com/photo-1485846234645-a62644f84728?w=800', 
  4, 1
),
(
  'Svemirski turizam postaje stvarnost?', 
  'Danas je uspješno završen prvi komercijalni let s civilnom posadom. Iako cijena karte i dalje dostiže astronomske iznose, potražnja nikada nije bila veća.', 
  'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800', 
  3, 1
);

INSERT INTO comments (news_id, user_id, text) VALUES 
(1, 2, 'Odličan članak! Jedva čekam testove novih procesora.'),
(1, 1, 'Hvala Mateo, stižu čim dobijemo prve primjerke u redakciju.'),
(2, 2, 'Nevjerojatna utakmica, sudac je stvarno pogriješio na kraju.'),
(3, 1, 'Konačno malo reda u radu od kuće, bit će zanimljivo vidjeti primjenu.'),
(5, 2, 'Svemirski turizam je super, ali tko će to moći platiti osim milijardera?');